
<div class='podcastPlayer'>
	<audio >
		<source src="{{podcast.url}}" type="audio/mpeg">
	</audio>

	<div class='guAudioPlayer'>
		<div class='playerContainer'>
			<div class='guPlayerBtn {{#isPlaying}}playerIsPlaying{{/isPlaying}}' on-click='triggerPlayPause'>
				{{#canPlay}}
				<svg x="0px" y="0px" viewBox="0 0 100 100">
					<circle fill="#AAD8F1" cx="50" cy="50" r="48"/>
					<polygon class='guPause' points="45.9,65.5 37.6,65.5 37.6,34.5 39.6,32.5 45.9,32.5 "/>
					<polygon class='guPause' points="62.4,63.5 60.4,65.5 54.1,65.5 54.1,32.5 62.4,32.5 "/>
					<polygon class='guPlay' points="72.2,49.3 38.1,35.2 36.9,36.1 36.9,63.9 38.1,64.8 72.2,50.7 "/>
				</svg>
				{{/canPlay}}
			</div>
		
			<div class='guProgressContainer'>	
				<div class='guListenLabel f-bodycopy'>Listen</div>
				<div class='guProgressBar'>
					
					<div class='guProgress' style='width: {{percentPlayed}}%;'></div>
					<div class='guProgBarHit' on-mousedown='triggerMouseDown' on-mouseup='triggerMouseUp' on-mousemove='triggerMouseMove'></div>
				</div>
				<div class='guTimer f-textSans'>{{calcPosition}} / {{calcDuration}}</div>
			</div>
		</div>

		<div class='guPodcastLinks'>
			<div class='guPodcastLink iTunes f-textSans'>Subscribe via iTunes</div>
			<div class='guPodcastLink download f-textSans'>Download MP3</div>
		</div>
	</div>

	
	

</div>



<style>



.guAudioPlayer {
	width: 100%;
	margin-top: 10px;

}

.playerContainer {
	display: table;
	width: 100%;
}

.guPlayerBtn {
	width: 40px;
	display: table-cell;
}

.guPause {
	display: none;
}

.playerIsPlaying .guPause {
	display: block;
}

.playerIsPlaying .guPlay {
	display: none;
}

.guProgressContainer {
	max-width: 640px;
	padding-left: 10px;
	display: table-cell;
	vertical-align: top;
}

.guTimer {
	color: #fff;
	font-size: 12px;
	display: inline-block;
}

.guListenLabel {
	color: #fff;
	font-size: .8rem;
	line-height: .8rem;
}

.guProgressBar {
	margin: 5px 0;
	position: relative;
	height: 15px;
	background: #767676;
	cursor: pointer;
}

.guProgBarHit {
	width: 100%;
	height: 100%;
	position: absolute;
}

.guProgress {
	background: #AAD8F1;
	position: absolute;
	height: 15px;
}

.guPodcastLinks {
	width: 100%;
	margin: 10px 0;
	border-top: 1px solid #767676;
	padding-top: 10px;
}

.guPodcastLink {
	float: left;
	padding: 5px 0 5px 0px;
	width: 100%;
	color: #fff;
	font-size: .85rem;
	height: 18px;
	line-height: .85rem;
	margin: 5px 0;
}

.guPodcastLink.iTunes {
	padding: 5px 0 5px 25px;
	background-size: 15px;
	background-repeat: no-repeat;
	background-position: left center;
	background-image: url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz48IURPQ1RZUEUgc3ZnIFBVQkxJQyAiLS8vVzNDLy9EVEQgU1ZHIDEuMS8vRU4iICJodHRwOi8vd3d3LnczLm9yZy9HcmFwaGljcy9TVkcvMS4xL0RURC9zdmcxMS5kdGQiPjxzdmcgdmVyc2lvbj0iMS4xIiBpZD0iTGF5ZXJfMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgeD0iMHB4IiB5PSIwcHgiIHZpZXdCb3g9IjAgMCAzMCAzMCIgZW5hYmxlLWJhY2tncm91bmQ9Im5ldyAwIDAgMzAgMzAiIHhtbDpzcGFjZT0icHJlc2VydmUiPjxwb2x5Z29uIGZpbGw9IiNGRkZGRkYiIHBvaW50cz0iMTMuNiwyLjcgNi4zLDEwIDEuMywxMCAwLDExLjMgMCwxOC43IDEuMiwxOS45IDYuMywxOS45IDEzLjYsMjcuMyAxNSwyNy4zIDE1LDIuNyAiLz48Zz48cGF0aCBmaWxsPSIjRkZGRkZGIiBkPSJNMjcuNiwxNWMwLDMuNy0xLjMsNy0zLjQsOS43bDAuNywwLjdjMy0yLjUsNS02LjMsNS0xMC41cy0xLjktOC01LTEwLjVsLTAuNywwLjdDMjYuMyw3LjksMjcuNiwxMS4zLDI3LjYsMTV6Ii8+PC9nPjxnPjxwYXRoIGZpbGw9IiNGRkZGRkYiIGQ9Ik0yMC41LDE1YzAsMi4xLTAuNiw0LjEtMS43LDUuN2wwLjksMC45YzEuNy0xLjcsMi43LTQsMi43LTYuNmMwLTIuNi0xLTQuOS0yLjctNi42bC0wLjksMC45QzE5LjksMTAuOSwyMC41LDEyLjgsMjAuNSwxNXoiLz48L2c+PGc+PC9nPjxnPjwvZz48Zz48L2c+PGc+PC9nPjxnPjwvZz48Zz48L2c+PGc+PC9nPjxnPjwvZz48Zz48L2c+PGc+PC9nPjxnPjwvZz48Zz48L2c+PGc+PC9nPjxnPjwvZz48Zz48L2c+PC9zdmc+);

}


.guPodcastLink.download {
	padding: 5px 0 5px 25px;
	background-size: 15px;
	background-repeat: no-repeat;
	background-position: left center;
	background-image: url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz48IURPQ1RZUEUgc3ZnIFBVQkxJQyAiLS8vVzNDLy9EVEQgU1ZHIDEuMS8vRU4iICJodHRwOi8vd3d3LnczLm9yZy9HcmFwaGljcy9TVkcvMS4xL0RURC9zdmcxMS5kdGQiPjxzdmcgdmVyc2lvbj0iMS4xIiBpZD0iTGF5ZXJfMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgeD0iMHB4IiB5PSIwcHgiIHZpZXdCb3g9IjAgMCAzMCAzMCIgZW5hYmxlLWJhY2tncm91bmQ9Im5ldyAwIDAgMzAgMzAiIHhtbDpzcGFjZT0icHJlc2VydmUiPjxjaXJjbGUgZmlsbD0iI0ZGRkZGRiIgY3g9IjYuMSIgY3k9IjIzLjYiIHI9IjUuNCIvPjxnPjxwYXRoIGZpbGw9IiNGRkZGRkYiIGQ9Ik0yOS4xLDIzLjZjMi0xMy41LTkuNS0yNS0yMy0yM1YyYzExLjksMCwyMS42LDkuNywyMS42LDIxLjYiLz48L2c+PHBhdGggZmlsbD0iI0ZGRkZGRiIgZD0iTTE5LjcsMjMuNmMxLjUtOC40LTUuMS0xNS0xMy41LTEzLjV2MS40YzYuNywwLDEyLjIsNS40LDEyLjIsMTIuMmgwSDE5Ljd6Ii8+PGc+PC9nPjxnPjwvZz48Zz48L2c+PGc+PC9nPjxnPjwvZz48Zz48L2c+PGc+PC9nPjxnPjwvZz48Zz48L2c+PGc+PC9nPjxnPjwvZz48Zz48L2c+PGc+PC9nPjxnPjwvZz48Zz48L2c+PC9zdmc+);


}

@media (min-width: 980px){
	.playerContainer {
		width: 360px;
		float: left;
	}

	.guPodcastLinks {
		width: 180px;
		float: left;
		border-top: none;
		padding: 0 0 0 15px;
		margin: 0;
		
	}

	.guPlayerBtn {
		width: 100px;
	}

	.guListenLabel {
		font-size: 1.15rem;
		line-height: 1.25rem;
	}

	.guProgressContainer {
		vertical-align: middle;
		border-right: 1px solid #4A4A4A;
		padding-right: 20px;
	}
}

</style>

<script>

var convertTime = function(time){
					//convert seconds to MM:SS format
					var minutes = Math.floor(time / 60);
					var seconds = Math.floor(time - (minutes * 60));
					if(seconds < 10 ){
						seconds = "0"+ seconds.toString();
					} 
					return minutes + ':' + seconds;
				}


component.exports = {

	data: {
			isPlaying: false,
			canPlay: false,
			duration: 0, // seconds long audio file
			position: 0, // current play position in seconds
			currentPosition: 0  //seconds that have played
			
	},
	computed: {
		calcDuration: function(){
			var d = this.get('duration')
			return convertTime(d);
		},
		calcPosition: function(){
			var d = this.get('position')
			return convertTime(d);
		},
		percentPlayed: function(){
			return this.get('position') / this.get('duration') * 100;
		}
	},
	onrender: function(){
		//component reference
		var that = this;
		var isMouseDown = false;
		var progBarEl = this.find('.guProgressBar');
		//player reference
		var audioPlayer = this.find('audio');
		audioPlayer.onloadeddata = function(e){
			that.set('canPlay', true);
			that.set('duration', audioPlayer.duration);
		}
		audioPlayer.ontimeupdate = function(e){
			that.set('position', audioPlayer.currentTime)
		}



		//assigh events
		this.on({
			triggerPlayPause: function(e){
				this.toggle('isPlaying')
			},
			triggerMouseMove: function(e){
				if(isMouseDown){
						var rect =  progBarEl.getBoundingClientRect();
						var width = rect.right - rect.left;
				        var offsetX = e.original.clientX - rect.left;
				 		var pct = offsetX / width;

				 		console.log(offsetX, width, this.get('duration'), this.get('duration') * pct)
				 		audioPlayer.currentTime = this.get('duration') * pct;

				}
			},
			triggerMouseDown: function(e){
				isMouseDown = true;
			},
			triggerMouseUp: function(e){
				isMouseDown = false;
			}


		})
		this.observe('isPlaying', function(state){
			if(state == true){
				audioPlayer.play();
			} else {
				audioPlayer.pause();
			}
		})



		//audioPlayer.play();
	}

}

</script>